---
interface Props {
  type?: TokenType;
  color?: 'red' | 'blue' | 'green' | 'orange' | 'purple' | 'grey';
  style?: 'badge' | 'text';
  icon?: boolean;
  maxWidth?: string;
}

const { type = 'default', color, style = 'badge', icon = false, maxWidth = '' } = Astro.props;
const tokenStyle: 'badge' | 'text' = style;

const semanticColors = {
  warn:    { badge: 'border-red-400 bg-red-200 [&_*]:bg-red-200', text: 'text-red-600 [&_*]:text-red-600' },
  danger:  { 
    badge: 'border-red-400 bg-red-200 [&_*]:bg-red-200 [&_*]:font-bold', 
    text: 'text-red-600 [&_*]:text-red-600 [&_*]:font-bold' 
  },
  info:    { badge: 'border-blue-400 bg-blue-200 [&_*]:bg-blue-200', text: 'text-blue-600 [&_*]:text-blue-600' },
  success: { badge: 'border-green-400 bg-green-200 [&_*]:bg-green-200', text: 'text-green-600 [&_*]:text-green-600' },
  optional:{ badge: 'border-purple-400 bg-purple-200 [&_*]:bg-purple-200', text: 'text-purple-600 [&_*]:text-purple-600' },
  pro: {
  badge: 'border-orange-400 bg-orange-200 [&_*]:bg-orange-200 [&_*]:uppercase', 
  text: 'text-orange-600 [&_*]:text-orange-600 [&_*]:uppercase'
  },
  alt: {
  badge: 'border-green-400 bg-green-200 [&_*]:bg-green-200 [&_*]:font-bold [&_*]:uppercase', 
  text: 'text-green-600 [&_*]:text-green-600 [&_*]:font-bold [&_*]:uppercase'
  },
  default: { badge: 'border-gray-400 bg-gray-200 [&_*]:bg-gray-200', text: 'text-gray-600 [&_*]:text-gray-600' },
} as const;

type TokenType = keyof typeof semanticColors; // <-- fixes TypeScript

const colorMap = {
  red:    { badge: 'border-red-400 bg-red-200 [&_*]:bg-red-200', text: 'text-red-600 [&_*]:text-red-600' },
  blue:   { badge: 'border-blue-400 bg-blue-200 [&_*]:bg-blue-200', text: 'text-blue-600 [&_*]:text-blue-600' },
  green:  { badge: 'border-green-400 bg-green-200 [&_*]:bg-green-200', text: 'text-green-600 [&_*]:text-green-600' },
  orange: { badge: 'border-orange-400 bg-orange-200 [&_*]:bg-orange-200', text: 'text-orange-600 [&_*]:text-orange-600' },
  purple: { badge: 'border-purple-400 bg-purple-200 [&_*]:bg-purple-200', text: 'text-purple-600 [&_*]:text-purple-600' },
  grey:   { badge: 'border-gray-400 bg-gray-200 [&_*]:bg-gray-200', text: 'text-gray-600 [&_*]:text-gray-600' },
  yellow: { badge: 'border-yellow-400 bg-yellow-200 [&_*]:bg-yellow-200', text: 'text-yellow-600 [&_*]:text-yellow-600' },
};

// Icons
const icons: Record<string, string> = {
  warn: '‚ö†Ô∏è',
  danger: 'üíÄ',
  info: '‚ÑπÔ∏è',
  pro: '‚≠ê',
  alt: 'üîÄ'
};

const displayIcon = (icon || type in icons) ? icons[type] ?? '' : '';

const safeType = type in semanticColors ? type : 'default';

const appliedClass = color
  ? colorMap[color]?.[tokenStyle] ?? ''
  : semanticColors[safeType][tokenStyle];

const baseClass =
  tokenStyle === 'badge'
    ? `inline-block rounded-lg py-0.5 px-2 pointer-events-none border text-sm font-sans tracking-tight break-words ${maxWidth} mr-1 mb-0.5 last:mr-0`
    : `inline-block text-sm font-sans tracking-tight break-words`;

---
<span class={`${baseClass} ${appliedClass}`}>
  {displayIcon && <span class="inline mr-1">{displayIcon}</span>}
  <span class="inline"><slot /></span>
</span>
